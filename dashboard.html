<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Ready2Study</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/api-service.js"></script>
</head>

<body>
    <header>
        <div class="container nav-content">
            <a href="index.html" class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
                Ready<span>2Study</span>
            </a>
            <div id="studentHeaderInfo" style="display: none; align-items: center; gap: 1rem; margin-left: auto; justify-content: flex-end;">
                <!-- Profile Card -->
                <div style="padding: 1rem 1.25rem; background: linear-gradient(135deg, #bfdbfe 0%, #dbeafe 50%, #e0f2fe 100%); border-radius: 0.75rem; box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15), 0 0 0 1px rgba(59, 130, 246, 0.1); position: relative; min-height: 90px; width: auto; min-width: 400px;">
                    <div style="display: flex; flex-direction: column; height: 100%; justify-content: space-between;">
                        <div style="display: flex; justify-content: flex-end; margin-bottom: auto;">
                            <div id="headerName" style="font-family: 'Poppins', 'Montserrat', sans-serif; font-weight: 700; font-size: 1.25rem; color: #ec4899; letter-spacing: 0.02em; text-align: right;"></div>
                        </div>
                        <div id="headerDetails" style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; margin-top: auto;">
                            <span id="courseSpan" style="display: inline-flex; align-items: center; gap: 0.375rem; color: #7c3aed; background: rgba(167, 139, 250, 0.25); padding: 0.375rem 0.75rem; border-radius: 0.5rem; font-weight: 600; font-size: 0.75rem; border: 1px solid rgba(167, 139, 250, 0.3);"></span>
                            <span id="yearSpan" style="display: inline-flex; align-items: center; gap: 0.375rem; color: #a855f7; font-weight: 600; font-size: 0.75rem;"></span>
                            <span id="collegeSpan" style="display: inline-flex; align-items: center; gap: 0.375rem; color: #14b8a6; font-weight: 600; font-size: 0.75rem;"></span>
                        </div>
                    </div>
                </div>
                <!-- Logout Button -->
                <button id="logoutBtn" class="btn btn-secondary" style="padding: 0.625rem 1.25rem; font-size: 0.75rem; background: #ef4444; color: white; border: none; border-radius: 0.625rem; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3); font-weight: 600; display: flex; align-items: center; gap: 0.5rem; transition: all 0.2s; white-space: nowrap;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Logout
                </button>
            </div>
        </div>
    </header>

    <main class="dashboard-layout container">
        <aside class="sidebar">
            <div class="filter-group">
                <h3>Filter by Marks</h3>
                <button class="filter-btn active" data-filter="all">All Questions</button>
                <button class="filter-btn" data-filter="1">1 Mark</button>
                <button class="filter-btn" data-filter="2">2 Marks</button>
                <button class="filter-btn" data-filter="3">3 Marks</button>
                <button class="filter-btn" data-filter="10">10 Marks</button>
            </div>
            <div class="filter-group" style="margin-top: 2rem;">
                <h3>My Collections</h3>
                <button class="filter-btn" data-filter="important">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem; vertical-align: middle;">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                    </svg>
                    Important
                </button>
            </div>
            <div class="filter-group" style="margin-top: 2rem;">
                <h3>Practice Test</h3>
                <a href="test.html" class="filter-btn" style="background: var(--gradient-primary); color: white; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    Start Practice Test
                </a>
                <div style="margin-top: 0.75rem; padding: 0.75rem; background: #f8fafc; border-radius: 0.5rem; font-size: 0.75rem; color: var(--text-muted); line-height: 1.5;">
                    <div style="margin-bottom: 0.25rem;"><strong>üìä</strong> 20 Marks</div>
                    <div style="margin-bottom: 0.25rem;"><strong>‚è±Ô∏è</strong> 60 Minutes</div>
                    <div><strong>üé§</strong> Text/Voice Input</div>
                </div>
                <a href="test.html" class="filter-btn" style="margin-top: 0.75rem; background: var(--gradient-primary); color: white; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    Start
                </a>
            </div>
            <div class="filter-group" style="margin-top: 2rem;">
                <h3>Actions</h3>
                <button class="filter-btn" id="toggleHighlightMode" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                        <path d="M2 17l10 5 10-5"></path>
                        <path d="M2 12l10 5 10-5"></path>
                    </svg>
                    Highlight Key Points
                </button>
                <button class="filter-btn" id="unhighlightCurrentQuestion" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 6L6 18"></path>
                        <path d="M6 6l12 12"></path>
                    </svg>
                    Unhighlight Key Points
                </button>
                <button class="filter-btn" id="toggleAllAnswers">Show All Answers</button>
                <button class="filter-btn" id="viewFullPDF" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                    </svg>
                    View Full PDF Content
                </button>
                <button class="filter-btn" id="exportPDFBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem; vertical-align: middle;">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    Export Questions & Answers to PDF
                </button>
            </div>
            <div class="filter-group" style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, #f0fdfa 0%, #e0f2fe 100%); border-radius: 1rem; border: 2px solid #bae6fd;">
                <h3 style="margin-bottom: 1rem; color: var(--primary); display: flex; align-items: center; gap: 0.5rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 17H20v-2.5a2.5 2.5 0 0 0-2.5-2.5H9"></path>
                        <path d="M9 12H4V6.5A2.5 2.5 0 0 1 6.5 4H20v5.5a2.5 2.5 0 0 1-2.5 2.5H9z"></path>
                    </svg>
                    Study Tools
                </h3>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: white; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <div style="display: flex; gap: 0.25rem; align-items: center;">
                            <img src="https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=80&h=80&fit=crop&crop=center" alt="Books" style="width: 50px; height: 50px; object-fit: cover; border-radius: 0.375rem; border: 2px solid #e0e7ff;">
                            <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=center" alt="Books" style="width: 50px; height: 50px; object-fit: cover; border-radius: 0.375rem; border: 2px solid #e0e7ff; margin-left: -10px; z-index: 1; position: relative;">
                            <img src="https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=80&h=80&fit=crop&crop=center" alt="Books" style="width: 50px; height: 50px; object-fit: cover; border-radius: 0.375rem; border: 2px solid #e0e7ff; margin-left: -10px; z-index: 2; position: relative;">
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-main); font-size: 0.875rem;">Books</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Study Materials</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: white; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <img src="https://images.unsplash.com/photo-1583484963886-cfe2bff2945f?w=80&h=80&fit=crop&crop=center" alt="Pens" style="width: 50px; height: 50px; object-fit: cover; border-radius: 0.375rem; border: 2px solid #fee2e2; transform: rotate(-15deg);">
                            <img src="https://images.unsplash.com/photo-1561070791-2526d30994b5?w=80&h=80&fit=crop&crop=center" alt="Pens" style="width: 50px; height: 50px; object-fit: cover; border-radius: 0.375rem; border: 2px solid #fef3c7; transform: rotate(10deg); margin-left: -8px; z-index: 1; position: relative;">
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-main); font-size: 0.875rem;">Pens</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Writing Tools</div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <section class="content-area">
            <!-- PDF Content Section - Display First -->
            <div id="pdfContentSection" style="max-width: 900px; margin: 0 auto 2rem; padding: 2rem; background: white; border-radius: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border: 1px solid #e2e8f0; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 2px solid var(--primary);">
                    <h2 style="color: var(--primary); font-size: 1.1rem; margin: 0; display: flex; align-items: center; gap: 0.5rem; font-weight: 600;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                        Uploaded PDF Content
                    </h2>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <button id="generateQuestionsBtn" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600; font-size: 0.85rem; display: flex; align-items: center; gap: 0.5rem; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3); transition: all 0.2s;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="generateQuestionsIcon">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="12" y1="18" x2="12" y2="12"></line>
                                <line x1="9" y1="15" x2="15" y2="15"></line>
                            </svg>
                            <span id="generateQuestionsText">Generate Questions</span>
                        </button>
                        <button id="togglePDFContent" style="background: var(--gradient-primary); color: white; border: none; padding: 0.4rem 0.85rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600; font-size: 0.8rem;">
                            Hide PDF
                        </button>
                    </div>
                </div>
                <div id="pdfContentDisplay" style="max-height: none; overflow-y: visible; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; line-height: 1.8; color: var(--text-main); white-space: pre-wrap; word-wrap: break-word;">
                    <p style="color: var(--text-muted);">Loading PDF content...</p>
                </div>
            </div>
            
            <!-- Section Separator -->
            <div style="max-width: 900px; margin: 1.5rem auto 1.5rem; padding: 1.5rem; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 0.75rem; border-left: 4px solid #10b981; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);">
                <h2 style="color: #059669; font-size: 1.1rem; font-weight: 700; margin: 0 0 0.75rem 0; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    üìù Generated Questions & Answers
                </h2>
                <p style="color: #047857; font-size: 0.85rem; margin: 0 0 1rem 0; text-align: center;">Practice these questions to test your understanding of the PDF content above</p>
                
                <!-- Features Info -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.5rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(16, 185, 129, 0.2);">
                    <div style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.75rem; color: #065f46;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                        <span><strong>Clarify Doubt</strong></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.75rem; color: #065f46;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg>
                        <span><strong>Sources</strong></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.75rem; color: #065f46;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>
                        <span><strong>Highlight</strong></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.75rem; color: #065f46;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                        <span><strong>Listen</strong></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.75rem; color: #065f46;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 8l6 6"></path><path d="M4 14l6-6 2-3"></path></svg>
                        <span><strong>Translate</strong></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.75rem; color: #065f46;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                        <span><strong>Save</strong></span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.4rem; font-size: 0.75rem; color: #065f46;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                        <span><strong>Attach Media</strong></span>
                    </div>
                </div>
                <p style="color: #047857; font-size: 0.7rem; margin: 0.75rem 0 0 0; text-align: center; font-style: italic;">‚ú® All features available on each question card below ‚ú®</p>
            </div>
            
            <!-- Question Progress and Navigation -->
            <div style="max-width: 900px; margin: 0 auto 1rem; display: flex; justify-content: space-between; align-items: center;">
                <div id="questionProgress" style="font-size: 0.95rem; font-weight: 600; color: var(--primary);"></div>
                <div id="navigationControls" style="display: none; gap: 0.5rem;">
                    <button id="prevQuestionBtn" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.25rem;">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                        Previous
                    </button>
                    <button id="nextQuestionBtn" class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                        Next
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: 0.25rem;">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Questions and Answers Container - Grid Display -->
            <div class="questions-grid" id="questionsContainer" style="min-height: 500px; width: 100%; max-width: 900px; margin: 0 auto;">
                <!-- All Questions and Answers will be displayed here -->
            </div>
        </section>
    </main>

    <!-- Sources Sidebar -->
    <div id="sourcesSidebar" class="sources-sidebar">
        <div class="sources-sidebar-header">
            <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;">
                    <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path>
                </svg>
                Sources & Resources
            </h3>
            <button id="closeSourcesSidebar" class="close-sources-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="sources-sidebar-content">
            <div id="sourcesLoading" class="sources-loading" style="display: none;">
                <div class="loader-spinner"></div>
                <p>Loading sources...</p>
            </div>
            <div id="sourcesContent">
                <div class="sources-section">
                    <h4>Video Links</h4>
                    <div id="videoLinks" class="sources-links"></div>
                </div>
                <div class="sources-section">
                    <h4>Related Articles</h4>
                    <div id="articleLinks" class="sources-links"></div>
                </div>
                <div class="sources-section">
                    <h4>Related Images</h4>
                    <div id="relatedImages" class="sources-images"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="sourcesSidebarOverlay" class="sources-sidebar-overlay"></div>

    <!-- Chat Button -->
    <button class="chat-button" id="chatButton" title="Chat about questions" style="bottom: 2rem; right: 2rem;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </button>

    <!-- Math Calculator Button -->
    <button class="chat-button" id="calculatorButton" title="Math Calculator" style="bottom: 8rem; right: 2rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="4" y="2" width="16" height="20" rx="2"></rect>
            <line x1="8" y1="6" x2="16" y2="6"></line>
            <line x1="8" y1="10" x2="16" y2="10"></line>
            <line x1="8" y1="14" x2="16" y2="14"></line>
            <line x1="8" y1="18" x2="16" y2="18"></line>
        </svg>
    </button>

    <!-- Translate Button (Orange with A/‡ÆÖ) -->
    <button class="chat-button" id="translateButton" title="Translate to Tamil" style="bottom: 14rem; right: 2rem; background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); font-weight: 700; font-size: 0.9rem; color: white; display: flex !important; align-items: center !important; justify-content: center !important; min-width: 60px; width: auto; padding: 0 0.75rem; border-radius: 30px;">
        <span style="font-family: 'Inter', 'Poppins', sans-serif; font-size: 0.9rem; line-height: 1;">A</span>
        <span style="margin: 0 0.2rem; opacity: 0.9; font-size: 0.9rem; line-height: 1;">/</span>
        <span style="font-family: 'Noto Sans Tamil', 'Arial Unicode MS', sans-serif; font-size: 0.9rem; line-height: 1;">‡ÆÖ</span>
    </button>


    <!-- Chat Modal -->
    <div class="chat-modal" id="chatModal">
        <div class="chat-modal-content">
            <div class="chat-header">
                <h3 id="chatHeaderTitle">Chat About Questions</h3>
                <button class="chat-close" id="chatClose">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message bot-message">
                    <div class="message-content">
                        <p id="chatWelcomeMessage">Hello! I'm here to help you with questions. Ask me anything!</p>
                    </div>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Type your question here...">
                <button class="chat-send" id="chatSend">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Media Upload Modal -->
    <div class="media-modal" id="mediaModal">
        <div class="media-modal-content">
            <div class="media-modal-header">
                <h3>Attach Media to Question</h3>
                <button class="media-close" id="mediaClose">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="media-modal-body">
                <div class="media-upload-zone" id="mediaUploadZone">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--text-muted); margin-bottom: 1rem;">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                    <h4>Upload Image or Video</h4>
                    <p style="color: var(--text-muted); font-size: 0.875rem; margin: 0.5rem 0;">Drag & drop or click to browse</p>
                    <input type="file" id="mediaFileInput" accept="image/*,video/*" style="display: none;">
                    <button class="btn btn-primary" onclick="document.getElementById('mediaFileInput').click()">Choose File</button>
                </div>
                <div id="mediaPreview" style="display: none; margin-top: 1.5rem;">
                    <div id="mediaPreviewContent"></div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary" id="removeMediaBtn">Remove</button>
                        <button class="btn btn-primary" id="saveMediaBtn">Attach to Question</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div class="media-modal" id="imageViewerModal" style="background: rgba(0, 0, 0, 0.9);">
        <div class="media-modal-content" style="max-width: 90%; max-height: 90vh; background: #1e293b; border-radius: 1rem;">
            <div class="media-modal-header" style="background: #0f172a; color: white;">
                <h3 id="imageViewerTitle">View Image</h3>
                <button class="media-close" id="imageViewerClose" style="color: white;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="media-modal-body" style="padding: 2rem; text-align: center; max-height: 75vh; overflow: auto;">
                <img id="imageViewerImg" src="" alt="Full size image" style="max-width: 100%; max-height: 70vh; object-fit: contain; border-radius: 0.5rem; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
            </div>
        </div>
    </div>

    <!-- PDF Content Modal -->
    <div class="pdf-content-modal" id="pdfContentModal">
        <div class="pdf-content-modal-content">
            <div class="pdf-content-header">
                <h3>Full PDF Content</h3>
                <button class="pdf-content-close" id="pdfContentClose">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="pdf-content-body" id="pdfContentBody">
                <p style="color: var(--text-muted);">Loading PDF content...</p>
            </div>
        </div>
    </div>

    <!-- Calculator Modal -->
    <div class="calculator-modal" id="calculatorModal">
        <div class="calculator-modal-content">
            <div class="calculator-header">
                <h3>Math Calculator</h3>
                <button class="calculator-close" id="calculatorClose">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="calculator-body">
                <div class="calculator-display" id="calculatorDisplay">0</div>
                <div class="calculator-buttons">
                    <button class="calc-btn calc-clear" onclick="clearCalculator()">C</button>
                    <button class="calc-btn calc-clear" onclick="clearEntry()">CE</button>
                    <button class="calc-btn calc-operator" onclick="appendToCalc('/')">/</button>
                    <button class="calc-btn calc-operator" onclick="appendToCalc('*')">√ó</button>
                    
                    <button class="calc-btn" onclick="appendToCalc('7')">7</button>
                    <button class="calc-btn" onclick="appendToCalc('8')">8</button>
                    <button class="calc-btn" onclick="appendToCalc('9')">9</button>
                    <button class="calc-btn calc-operator" onclick="appendToCalc('-')">-</button>
                    
                    <button class="calc-btn" onclick="appendToCalc('4')">4</button>
                    <button class="calc-btn" onclick="appendToCalc('5')">5</button>
                    <button class="calc-btn" onclick="appendToCalc('6')">6</button>
                    <button class="calc-btn calc-operator" onclick="appendToCalc('+')">+</button>
                    
                    <button class="calc-btn" onclick="appendToCalc('1')">1</button>
                    <button class="calc-btn" onclick="appendToCalc('2')">2</button>
                    <button class="calc-btn" onclick="appendToCalc('3')">3</button>
                    <button class="calc-btn calc-equals" onclick="calculateResult()" rowspan="2">=</button>
                    
                    <button class="calc-btn calc-zero" onclick="appendToCalc('0')">0</button>
                    <button class="calc-btn" onclick="appendToCalc('.')">.</button>
                    <button class="calc-btn calc-operator" onclick="appendToCalc('(')">(</button>
                    <button class="calc-btn calc-operator" onclick="appendToCalc(')')">)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Translate Modal -->
    <div class="translate-modal" id="translateModal">
        <div class="translate-modal-content">
            <div class="translate-header">
                <h3>Translate to Tamil</h3>
                <button class="translate-close" id="translateClose">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="translate-body">
                <div class="translate-input-section">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-main);">English Text:</label>
                    <textarea id="translateInput" class="translate-input" placeholder="Enter text to translate to Tamil..." rows="4"></textarea>
                </div>
                <button class="btn btn-primary" id="translateBtn" style="width: 100%; margin-top: 1rem;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;">
                        <path d="M5 8l6 6"></path>
                        <path d="M4 14l6-6 2-3"></path>
                    </svg>
                    Translate to Tamil
                </button>
                <div class="translate-output-section" id="translateOutputSection" style="display: none; margin-top: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-main);">Tamil Translation:</label>
                    <div id="translateOutput" class="translate-output"></div>
                    <button class="btn btn-secondary" id="copyTranslationBtn" style="width: 100%; margin-top: 0.75rem;">
                        Copy Translation
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/mockData.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Calculator functionality
        let calculatorValue = '0';
        let shouldResetDisplay = false;

        function updateCalculatorDisplay() {
            document.getElementById('calculatorDisplay').textContent = calculatorValue;
        }

        function appendToCalc(value) {
            if (shouldResetDisplay) {
                calculatorValue = '0';
                shouldResetDisplay = false;
            }
            if (calculatorValue === '0' && value !== '.') {
                calculatorValue = value;
            } else {
                calculatorValue += value;
            }
            updateCalculatorDisplay();
        }

        function clearCalculator() {
            calculatorValue = '0';
            updateCalculatorDisplay();
        }

        function clearEntry() {
            calculatorValue = '0';
            updateCalculatorDisplay();
        }

        function calculateResult() {
            try {
                // Replace √ó with * for evaluation
                const expression = calculatorValue.replace(/√ó/g, '*');
                const result = Function('"use strict"; return (' + expression + ')')();
                calculatorValue = result.toString();
                shouldResetDisplay = true;
                updateCalculatorDisplay();
            } catch (error) {
                calculatorValue = 'Error';
                updateCalculatorDisplay();
                setTimeout(() => {
                    calculatorValue = '0';
                    updateCalculatorDisplay();
                }, 2000);
            }
        }

        // Calculator Modal
        const calculatorModal = document.getElementById('calculatorModal');
        const calculatorButton = document.getElementById('calculatorButton');
        const calculatorClose = document.getElementById('calculatorClose');

        if (calculatorButton) {
            calculatorButton.addEventListener('click', () => {
                calculatorModal.classList.add('active');
            });
        }

        if (calculatorClose) {
            calculatorClose.addEventListener('click', () => {
                calculatorModal.classList.remove('active');
            });
        }

        if (calculatorModal) {
            calculatorModal.addEventListener('click', (e) => {
                if (e.target === calculatorModal) {
                    calculatorModal.classList.remove('active');
                }
            });
        }

        // Translation functionality
        async function translateToTamil() {
            const inputText = document.getElementById('translateInput').value.trim();
            if (!inputText) {
                alert('Please enter text to translate.');
                return;
            }

            const translateBtn = document.getElementById('translateBtn');
            const outputSection = document.getElementById('translateOutputSection');
            const output = document.getElementById('translateOutput');

            translateBtn.disabled = true;
            translateBtn.innerHTML = 'Translating...';
            outputSection.style.display = 'none';

            try {
                // Use MyMemory Translation API
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(inputText)}&langpair=en|ta`);
                const data = await response.json();

                if (data.responseStatus === 200 && data.responseData && data.responseData.translatedText) {
                    // Get the raw translated text
                    let tamilText = data.responseData.translatedText;
                    
                    // Clean unwanted metadata
                    tamilText = tamilText.replace(/%\s*\d+[‡ÆÆ‡ØÇ‡Æ≤‡ÆÆ‡Øç@\s]*info:.*$/gi, '').trim();
                    tamilText = tamilText.replace(/@\s*info:.*$/gi, '').trim();
                    tamilText = tamilText.replace(/whatsthis/gi, '').trim();
                    tamilText = tamilText.replace(/^[%\d@\s:]+/, '').trim();
                    
                    // Ensure we have text
                    if (!tamilText || tamilText.length === 0) {
                        tamilText = data.responseData.translatedText.trim();
                    }
                    
                    // Properly decode and set Tamil text
                    // Clear output first
                    output.innerHTML = '';
                    
                    // Create a text node to ensure proper Unicode handling
                    const textNode = document.createTextNode(tamilText);
                    output.appendChild(textNode);
                    
                    // Set Tamil-specific styling
                    output.setAttribute('lang', 'ta');
                    output.setAttribute('dir', 'ltr');
                    output.style.fontFamily = "'Noto Sans Tamil', 'Arial Unicode MS', 'Tamil Sangam MN', sans-serif";
                    output.style.fontSize = '1.125rem';
                    output.style.lineHeight = '1.8';
                    output.style.color = '#1e293b';
                    output.style.whiteSpace = 'pre-wrap';
                    output.style.wordWrap = 'break-word';
                    
                    outputSection.style.display = 'block';
                } else {
                    throw new Error('Translation failed: ' + (data.responseDetails || 'Unknown error'));
                }
            } catch (error) {
                console.error('Translation error:', error);
                output.innerHTML = '';
                output.textContent = 'Translation service temporarily unavailable. Please try again later.';
                output.style.fontFamily = "'Inter', sans-serif";
                outputSection.style.display = 'block';
            } finally {
                translateBtn.disabled = false;
                translateBtn.innerHTML = `
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;">
                        <path d="M5 8l6 6"></path>
                        <path d="M4 14l6-6 2-3"></path>
                    </svg>
                    Translate to Tamil
                `;
            }
        }

        function copyTranslation() {
            const output = document.getElementById('translateOutput');
            // Get text content properly handling Tamil characters
            const tamilText = output.innerText || output.textContent;
            navigator.clipboard.writeText(tamilText).then(() => {
                const btn = document.getElementById('copyTranslationBtn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#10b981';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy translation. Please select and copy manually.');
            });
        }

        // Translate Modal
        const translateModal = document.getElementById('translateModal');
        const translateButton = document.getElementById('translateButton');
        const translateClose = document.getElementById('translateClose');
        const translateBtn = document.getElementById('translateBtn');
        const copyBtn = document.getElementById('copyTranslationBtn');

        if (translateButton) {
            translateButton.addEventListener('click', () => {
                translateModal.classList.add('active');
                document.getElementById('translateInput').focus();
            });
        }


        // PDF Content Modal Close Handlers
        const pdfContentClose = document.getElementById('pdfContentClose');
        const pdfContentModal = document.getElementById('pdfContentModal');
        
        if (pdfContentClose) {
            pdfContentClose.addEventListener('click', () => {
                pdfContentModal.classList.remove('active');
            });
        }

        if (pdfContentModal) {
            pdfContentModal.addEventListener('click', (e) => {
                if (e.target === pdfContentModal) {
                    pdfContentModal.classList.remove('active');
                }
            });
        }

        if (translateClose) {
            translateClose.addEventListener('click', () => {
                translateModal.classList.remove('active');
            });
        }

        if (translateModal) {
            translateModal.addEventListener('click', (e) => {
                if (e.target === translateModal) {
                    translateModal.classList.remove('active');
                }
            });
        }

        if (translateBtn) {
            translateBtn.addEventListener('click', translateToTamil);
        }

        if (copyBtn) {
            copyBtn.addEventListener('click', copyTranslation);
        }
    </script>
</body>

</html>
